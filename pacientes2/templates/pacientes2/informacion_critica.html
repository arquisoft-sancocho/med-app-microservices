{% extends 'base.html' %}

{% block content %}
<div class="content">
    <div class="container">
        <div class="page-header-title">
            <h2 class="page-title">Información Crítica de {{ paciente.nombre }}</h2>
            <div class="alert alert-danger">
                <i class="fa fa-exclamation-triangle"></i> <strong>VISTA CRÍTICA</strong> - Solo información médica relevante
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-body">
                <!-- Exámenes -->
                <h3>Exámenes</h3>
                {% if examenes %}
                    {% for examen in examenes %}
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <strong>{{ examen.get_tipo_examen_display }}</strong> - {{ examen.fecha_realizacion|date:"d/m/Y" }}
                            <a href="{% url 'examenDetail2' examen.id %}" class="btn btn-xs btn-default pull-right">
                                <i class="fa fa-eye"></i> Ver detalle
                            </a>
                        </div>
                        <div class="panel-body">
                            <p><strong>Resultado:</strong> {{ examen.resultado }}</p>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">No hay exámenes registrados.</div>
                {% endif %}

                <!-- Diagnósticos -->
                <h3>Diagnósticos</h3>
                {% if diagnosticos %}
                    {% for diagnostico in diagnosticos %}
                    <div class="panel panel-warning">
                        <div class="panel-heading">
                            <strong>{{ diagnostico.nombre }}</strong> - {{ diagnostico.fecha_realizacion|date:"d/m/Y" }}
                            <a href="{% url 'diagnosticoDetail' diagnostico.id %}" class="btn btn-xs btn-default pull-right">
                                <i class="fa fa-eye"></i> Ver detalle
                            </a>
                        </div>
                        <div class="panel-body">
                            <p><strong>Resultados:</strong> {{ diagnostico.resultados_obtenidos }}</p>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">No hay diagnósticos registrados.</div>
                {% endif %}

                <!-- Consultas Médicas -->
                <h3>Consultas Médicas</h3>
                {% if consultas %}
                    {% for consulta in consultas %}
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <strong>{{ consulta.get_tipo_consulta_display }}</strong> - {{ consulta.fecha|date:"d/m/Y H:i" }}
                            <span class="badge">{{ consulta.prescripciones.count }} prescripciones</span>
                            <a href="{% url 'consultaDetail' consulta.id %}" class="btn btn-xs btn-default pull-right">
                                <i class="fa fa-eye"></i> Ver detalle
                            </a>
                        </div>
                        <div class="panel-body">
                            <p><strong>Motivo:</strong> {{ consulta.motivo }}</p>
                            {% if consulta.informacion_extra %}
                            <p><strong>Información adicional:</strong> {{ consulta.informacion_extra }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">No hay consultas médicas registradas.</div>
                {% endif %}

                <!-- Cirugías -->
                <h3>Cirugías</h3>
                {% if cirugias %}
                    {% for cirugia in cirugias %}
                    <div class="panel panel-danger">
                        <div class="panel-heading">
                            <strong>{{ cirugia.get_tipo_display }}</strong> - {{ cirugia.fecha|date:"d/m/Y" }}
                            <a href="{% url 'cirugiaDetail' cirugia.id %}" class="btn btn-xs btn-default pull-right">
                                <i class="fa fa-eye"></i> Ver detalle
                            </a>
                        </div>
                        <div class="panel-body">
                            <p><strong>Resultado:</strong> {{ cirugia.resultado }}</p>
                            <p><strong>Estado postoperatorio:</strong> {{ cirugia.get_estado_postoperatorio_display }}</p>
                            {% if cirugia.complicaciones %}
                            <p><strong>Complicaciones:</strong> {{ cirugia.complicaciones }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">No hay cirugías registradas.</div>
                {% endif %}

                <div class="text-center" style="margin-top: 20px;">
                    <a href="{% url 'pacienteDetail2' paciente.id %}" class="btn btn-primary">
                        <i class="fa fa-arrow-left"></i> Volver al detalle del paciente
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .panel-danger .panel-heading {
        background-color: #d9534f;
        color: white;
        border-color: #d9534f;
    }
    .panel-primary .panel-heading {
        background-color: #337ab7;
        color: white;
        border-color: #337ab7;
    }
    .panel-warning .panel-heading {
        background-color: #f0ad4e;
        color: white;
        border-color: #f0ad4e;
    }
    .panel-info .panel-heading {
        background-color: #5bc0de;
        color: white;
        border-color: #5bc0de;
    }
    .alert-danger {
        border-left: 5px solid #d9534f;
    }
    .badge {
        margin-left: 10px;
        background-color: white;
        color: #333;
    }
</style>
{% endblock %}