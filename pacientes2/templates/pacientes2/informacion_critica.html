{% extends 'base.html' %}

{% block content %}
<div class="content">
    <div class="container">
        <div class="page-header-title">
            <h2 class="page-title">Información Crítica de {{ paciente.nombre }}</h2>
            <div class="alert alert-danger">
                <strong>¡ATENCIÓN!</strong> Esta vista muestra solo información crítica del paciente.
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-body">
                <!-- Consultas Médicas -->
                <h3>Consultas Médicas</h3>
                {% if consultas %}
                <div class="table-responsive">
                    <table class="table table-hover table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>Tipo</th>
                                <th>Fecha</th>
                                <th>Motivo</th>
                                <th>Prescripciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for consulta in consultas %}
                            <tr>
                                <td>{{ consulta.get_tipo_consulta_display }}</td>
                                <td>{{ consulta.fecha|date:"d/m/Y H:i" }}</td>
                                <td>{{ consulta.motivo }}</td>
                                <td>{{ consulta.prescripciones.count }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">No hay consultas registradas.</div>
                {% endif %}

                <!-- Cirugías -->
                <h3>Cirugías</h3>
                {% if cirugias %}
                <div class="table-responsive">
                    <table class="table table-hover table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>Tipo</th>
                                <th>Fecha</th>
                                <th>Resultado</th>
                                <th>Estado Postoperatorio</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cirugia in cirugias %}
                            <tr>
                                <td>{{ cirugia.get_tipo_display }}</td>
                                <td>{{ cirugia.fecha|date:"d/m/Y" }}</td>
                                <td>{{ cirugia.resultado }}</td>
                                <td>{{ cirugia.get_estado_postoperatorio_display }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">No hay cirugías registradas.</div>
                {% endif %}

                <!-- Exámenes -->
                <h3>Exámenes</h3>
                {% if examenes %}
                <div class="table-responsive">
                    <table class="table table-hover table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>Tipo</th>
                                <th>Fecha</th>
                                <th>Resultado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for examen in examenes %}
                            <tr>
                                <td>{{ examen.get_tipo_examen_display }}</td>
                                <td>{{ examen.fecha_realizacion|date:"d/m/Y" }}</td>
                                <td>{{ examen.resultado }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">No hay exámenes registrados.</div>
                {% endif %}

                <!-- Diagnósticos -->
                <h3>Diagnósticos</h3>
                {% if diagnosticos %}
                <div class="table-responsive">
                    <table class="table table-hover table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>Nombre</th>
                                <th>Fecha</th>
                                <th>Resultados</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for diagnostico in diagnosticos %}
                            <tr>
                                <td>{{ diagnostico.nombre }}</td>
                                <td>{{ diagnostico.fecha_realizacion|date:"d/m/Y" }}</td>
                                <td>{{ diagnostico.resultados_obtenidos }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">No hay diagnósticos registrados.</div>
                {% endif %}

                <div class="text-center" style="margin-top: 20px;">
                    <a href="{% url 'pacienteDetail2' paciente.id %}" class="btn btn-primary">
                        <i class="fa fa-arrow-left"></i> Volver al detalle del paciente
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .table thead th {
        background-color: #d9534f;
        color: white;
    }
    .alert-danger {
        border-left: 5px solid #d9534f;
    }
</style>
{% endblock %}